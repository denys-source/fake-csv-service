{% load crispy_forms_tags %}
{% load helper_tags %}
{% for formset in formsets %}
  <div class="formset mt-3" data-formset-prefix={{ formset.prefix }}>
    {{ formset.management_form }}
    <fieldset class="collapsable border rounded-3 p-4">
      <legend class="float-none w-auto px-3" role="button">{% get_formset_name formset %}</legend>
      <div class="fieldset-contents">
        <div style="display: none;" class="{{ formset.prefix }}-empty-form">
          <div class="column-form d-flex gap-3 mb-4">
            <div class="d-flex align-items-end justify-content-center">
              <button type="button" class="btn btn-danger delete-form">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="flex-grow-1">{{ formset.empty_form|crispy }}</div>
          </div>
        </div>
        {% for form in formset %}
          <div class="column-form d-flex gap-3 mb-4">
            <div class="d-flex align-items-end justify-content-center">
              <button type="button" class="btn btn-danger delete-form">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
            <div class="flex-grow-1">{{ form|crispy }}</div>
          </div>
        {% endfor %}
        <button type="button" class="btn btn-primary mt-3 add-form">
          <i class="fas fa-plus"></i> Add column
        </button>
      </div>
    </fieldset>
  </div>
{% endfor %}
