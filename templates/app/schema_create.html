{% extends "base.html" %}
{% load crispy_forms_tags %}
{% block content %}
  <form method="post">
    <div class="row">
      {% csrf_token %}
      <div class="col-md-3">
        <h3>Create Schema</h3>
        {{ schema_form|crispy }}
        <input type="submit" class="btn btn-primary mt-3" value="Submit">
      </div>
      <div class="col-md-9">
        <h3>Add columns</h3>
        {% for formset in formsets %}
          <div class="formset mt-3" data-formset-prefix={{ formset.prefix }}>
            {{ formset.management_form }}
            <div style="display: none;" class="{{ formset.prefix }}-empty-form">
              <div class="d-flex flex-wrap gap-2 ">{{ formset.empty_form|crispy }}</div>
            </div>
            {% for form in formset %}<div class="d-flex flex-wrap gap-2 ">{{ form|crispy }}</div>{% endfor %}
            <button type="button" class="btn btn-primary mt-3 add-form">Add column</button>
          </div>
        {% endfor %}
      </div>
    </form>
  {% endblock content %}
  {% block script %}
    <script>
      $(document).ready(function() {
        $(".add-form").on("click", function() {
          let prefix = $(this).closest(".formset").data("formset-prefix");
          let form_id = $(`#id_${prefix}-TOTAL_FORMS`).val();

          let empty_form = $(`.${prefix}-empty-form`).clone();
          $(this).before(empty_form.html().replace(/__prefix__/g, form_id));

          $(`#id_${prefix}-TOTAL_FORMS`).val(parseInt(form_id) + 1);
        })
      })
    </script>
  {% endblock script %}
